
VSYNC : const *void  =  0x00;
VBLANK : const *void =  0x01;
WSYNC : const *void  =  0x02;

COLUBK : const *void =  0x09;

waitForVSync : () -> void {
   i : tiny = 0;
   while ( i < 192 ) {
      *COLUBK = i;
      ++i;
      *WSYNC = 1;
   }
}

endOfFrame : () -> void {
   *VBLANK = 0b01000010 ;
   
   i : tiny = 0;
   while ( i < 37 ) {
      *WSYNC = 1;
      ++i;
   }
   
}

__init : inline () -> void {
   __asm__("sei");
   __asm__("cld");
   __asm__("LDX #$FF");
   __asm__("txs");
}

main : () -> void {
   
   vsync_func : () -> void {
      *VBLANK = 0;
      *VSYNC = 2;
      
      i : tiny = 0;
      while (i < 3) {
         *WSYNC = 2;
         ++i;
      }
      
      *VSYNC = 0;
      
      i = 0;
      while ( i < 37 ) {
         *WSYNC = 1;
         ++i;
      }
   }
   
   while ( true ) {
      __init();
      vsync_func();
      waitForVSync();
      endOfFrame();
   }
}