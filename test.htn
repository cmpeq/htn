
vsync : const *void  =  0x00;
vblank : const *void =  0x01;
wsync : const *void  =  0x02;

colubk : const *void =  0x09;

waitForVSync : () -> void {
   i : tiny = 0;
   while ( i < 192 ) {
      *colubk = i;
      ++i;
      *wsync = 1;
   }
}

endOfFrame : () -> void {
   *vblank = 0b01000010 ;
   
   i : tiny = 0;
   while ( i < 37 ) {
      *wsync = 1;
      ++i;
   }
   
}

main : () -> void {
   
   vsync_func : () -> void {
      *vblank = 0;
      *vsync = 2;
      
      i : tiny = 0;
      while (i < 3) {
         *wsync = 2;
         ++i;
      }
      
      *vsync = 0;
      
      i = 0;
      while ( i < 37 ) {
         *wsync = 1;
         ++i;
      }
   }
   
   while ( true ) {
      __asm__("SEI");
      __asm__("CLD");
      __asm__("LDX #$FF");
      __asm__("txs");
      vsync_func();
      waitForVSync();
      endOfFrame();
   }
}